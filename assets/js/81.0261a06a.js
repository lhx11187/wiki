(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{437:function(s,a,t){"use strict";t.r(a);var n=t(42),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"rsync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rsync"}},[s._v("#")]),s._v(" rsync")]),s._v(" "),t("p",[s._v("Rsync 服务端和客户端都需要安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v("\n")])])]),t("h2",{attrs:{id:"远程同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程同步"}},[s._v("#")]),s._v(" 远程同步")]),s._v(" "),t("h3",{attrs:{id:"ssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[s._v("#")]),s._v(" SSH")]),s._v(" "),t("p",[s._v("推文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -av --delete -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -p 22"')]),s._v(" /etc/passwd "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.26:/tmp/passwd.txt\n")])])]),t("p",[s._v("拉文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -av --delete -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -p 22"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.26:/tmp/passwd.txt /tmp/test.txt\n")])])]),t("h3",{attrs:{id:"rsync-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rsync-2"}},[s._v("#")]),s._v(" Rsync")]),s._v(" "),t("p",[s._v("推文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avz --password-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/passwd /tmp/ admin@192.168.204.130::module/destination\n")])])]),t("p",[s._v("拉文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avz --password-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/passwd  admin@192.168.204.130::module/destination /tmp\n")])])]),t("p",[s._v("上面地址中的 "),t("code",[s._v("module")]),s._v(" 并不是实际路径名，而是 rsync 守护程序指定的一个资源名，由管理员分配。")]),s._v(" "),t("p",[s._v("如果想知道 rsync 守护程序分配的所有 module 列表，可以执行下面命令。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" rsync://192.168.122.32\n")])])]),t("p",[s._v("rsync 协议除了使用双冒号，也可以直接用 "),t("code",[s._v("rsync://")]),s._v(" 协议指定地址。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -av source/ rsync://192.168.122.32/module/destination\n")])])]),t("p",[s._v("列举整个同步目录或指定目录")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.26::\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.26::module\n")])])]),t("h3",{attrs:{id:"ssh-rsync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-rsync"}},[s._v("#")]),s._v(" SSH+Rsync")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avz --rsh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -l root"')]),s._v(" admin@192.168.11.26::module\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avz -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -l root"')]),s._v(" admin@192.168.11.26::module\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" -avz -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh -l root"')]),s._v(" rsync://admin@192.168.11.26/module\n")])])]),t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),t("h3",{attrs:{id:"服务端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置"}},[s._v("#")]),s._v(" 服务端配置")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/rsyncd.conf")]),s._v("\nmotd file "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /etc/rsyncd.motd")]),s._v("\ntransfer logging "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" yes")]),s._v("\nlog file "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /var/log/rsyncd.log")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("port")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 873")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("address")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 192.168.204.130")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("uid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" nobody")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("gid")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" nobody")]),s._v("\nuse chroot "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" no")]),s._v("\nread only "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" no")]),s._v("\nmax connections "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token selector"}},[s._v("[common]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("comment")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" rsync info")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /tmp")]),s._v("\nignore errors\nauth users "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" admin")]),s._v("\nsecrets file "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /etc/rsyncd.secrets")]),s._v("\nhosts allow "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 192.168.204.0/255.255.255.0")]),s._v("\nhosts deny "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" *")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("list")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" false")]),s._v("\n")])])]),t("p",[s._v("创建用户密码文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin:123456"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/rsyncd.secrets\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /etc/rsyncd.secrets\n")])])]),t("p",[s._v("创建提示信息文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsync info"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  /etc/rsyncd.motd\n")])])]),t("p",[s._v("启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" --daemon\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsync --daemon"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/rc.local\n")])])]),t("h3",{attrs:{id:"客户端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置"}},[s._v("#")]),s._v(" 客户端配置")]),s._v(" "),t("p",[s._v("创建密码文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /root/passwd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /root/passwd\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);