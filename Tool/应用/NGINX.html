<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx | 偷影子的人</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="让一切优异的品质成为你的习惯。">
    
    <link rel="preload" href="/assets/css/0.styles.fab77d47.css" as="style"><link rel="preload" href="/assets/js/app.1e781c0e.js" as="script"><link rel="preload" href="/assets/js/2.8b1cd733.js" as="script"><link rel="preload" href="/assets/js/118.bf00b42e.js" as="script"><link rel="prefetch" href="/assets/js/10.bb1a8080.js"><link rel="prefetch" href="/assets/js/100.c55d6109.js"><link rel="prefetch" href="/assets/js/101.67370e2f.js"><link rel="prefetch" href="/assets/js/102.d76b31a8.js"><link rel="prefetch" href="/assets/js/103.d715ab32.js"><link rel="prefetch" href="/assets/js/104.50cb2795.js"><link rel="prefetch" href="/assets/js/105.5980a7da.js"><link rel="prefetch" href="/assets/js/106.2cdab8c2.js"><link rel="prefetch" href="/assets/js/107.24d4d0d0.js"><link rel="prefetch" href="/assets/js/108.840cfb07.js"><link rel="prefetch" href="/assets/js/109.02ae4d8f.js"><link rel="prefetch" href="/assets/js/11.15083c03.js"><link rel="prefetch" href="/assets/js/110.6abc7bc1.js"><link rel="prefetch" href="/assets/js/111.457b1631.js"><link rel="prefetch" href="/assets/js/112.e5775f3b.js"><link rel="prefetch" href="/assets/js/113.2049e7a3.js"><link rel="prefetch" href="/assets/js/114.c95d456d.js"><link rel="prefetch" href="/assets/js/115.10c74837.js"><link rel="prefetch" href="/assets/js/116.93d93c76.js"><link rel="prefetch" href="/assets/js/117.147082ff.js"><link rel="prefetch" href="/assets/js/119.cc7e4109.js"><link rel="prefetch" href="/assets/js/12.f60c0490.js"><link rel="prefetch" href="/assets/js/120.c335c6d6.js"><link rel="prefetch" href="/assets/js/121.199fb7cd.js"><link rel="prefetch" href="/assets/js/122.8dad064c.js"><link rel="prefetch" href="/assets/js/123.153dc5f5.js"><link rel="prefetch" href="/assets/js/124.4118dd06.js"><link rel="prefetch" href="/assets/js/125.3bf9bbf5.js"><link rel="prefetch" href="/assets/js/126.3c2a4302.js"><link rel="prefetch" href="/assets/js/127.f41d79ab.js"><link rel="prefetch" href="/assets/js/128.fa88f156.js"><link rel="prefetch" href="/assets/js/129.73d879ac.js"><link rel="prefetch" href="/assets/js/13.415ae9c5.js"><link rel="prefetch" href="/assets/js/130.cdba95b2.js"><link rel="prefetch" href="/assets/js/131.e6d3f96a.js"><link rel="prefetch" href="/assets/js/132.accf3441.js"><link rel="prefetch" href="/assets/js/133.22c7528a.js"><link rel="prefetch" href="/assets/js/134.c8baffcf.js"><link rel="prefetch" href="/assets/js/135.55c3501d.js"><link rel="prefetch" href="/assets/js/136.3dccd719.js"><link rel="prefetch" href="/assets/js/137.2567893e.js"><link rel="prefetch" href="/assets/js/138.85bbd762.js"><link rel="prefetch" href="/assets/js/139.019dcf91.js"><link rel="prefetch" href="/assets/js/14.0c6ea488.js"><link rel="prefetch" href="/assets/js/140.8035c862.js"><link rel="prefetch" href="/assets/js/141.8ae73f3f.js"><link rel="prefetch" href="/assets/js/142.8153690d.js"><link rel="prefetch" href="/assets/js/143.a8c80197.js"><link rel="prefetch" href="/assets/js/144.d4393c5c.js"><link rel="prefetch" href="/assets/js/15.311a0e02.js"><link rel="prefetch" href="/assets/js/16.5364d944.js"><link rel="prefetch" href="/assets/js/17.947e8187.js"><link rel="prefetch" href="/assets/js/18.68b71525.js"><link rel="prefetch" href="/assets/js/19.176922e5.js"><link rel="prefetch" href="/assets/js/20.93b92415.js"><link rel="prefetch" href="/assets/js/21.67f1d4aa.js"><link rel="prefetch" href="/assets/js/22.4155bf1b.js"><link rel="prefetch" href="/assets/js/23.0e90c4c2.js"><link rel="prefetch" href="/assets/js/24.a54658f1.js"><link rel="prefetch" href="/assets/js/25.35cf44e0.js"><link rel="prefetch" href="/assets/js/26.a90195ee.js"><link rel="prefetch" href="/assets/js/27.d6fecd83.js"><link rel="prefetch" href="/assets/js/28.14a6ef36.js"><link rel="prefetch" href="/assets/js/29.792fc2ac.js"><link rel="prefetch" href="/assets/js/3.cb28393b.js"><link rel="prefetch" href="/assets/js/30.83582ccb.js"><link rel="prefetch" href="/assets/js/31.307a7ed6.js"><link rel="prefetch" href="/assets/js/32.cb47cd48.js"><link rel="prefetch" href="/assets/js/33.8d67c87a.js"><link rel="prefetch" href="/assets/js/34.4380dc10.js"><link rel="prefetch" href="/assets/js/35.d6513093.js"><link rel="prefetch" href="/assets/js/36.93f8359c.js"><link rel="prefetch" href="/assets/js/37.a55a6a5e.js"><link rel="prefetch" href="/assets/js/38.1780cedf.js"><link rel="prefetch" href="/assets/js/39.cd8f89ed.js"><link rel="prefetch" href="/assets/js/4.02d43310.js"><link rel="prefetch" href="/assets/js/40.5242318b.js"><link rel="prefetch" href="/assets/js/41.c18fd0af.js"><link rel="prefetch" href="/assets/js/42.e30d93c5.js"><link rel="prefetch" href="/assets/js/43.c7761445.js"><link rel="prefetch" href="/assets/js/44.1152b4fd.js"><link rel="prefetch" href="/assets/js/45.1abebb71.js"><link rel="prefetch" href="/assets/js/46.17fb0dd5.js"><link rel="prefetch" href="/assets/js/47.13901988.js"><link rel="prefetch" href="/assets/js/48.8c299410.js"><link rel="prefetch" href="/assets/js/49.bbc7d697.js"><link rel="prefetch" href="/assets/js/5.4fbfcbe1.js"><link rel="prefetch" href="/assets/js/50.f1654514.js"><link rel="prefetch" href="/assets/js/51.5477e3e6.js"><link rel="prefetch" href="/assets/js/52.4044446d.js"><link rel="prefetch" href="/assets/js/53.63990dfa.js"><link rel="prefetch" href="/assets/js/54.2f736219.js"><link rel="prefetch" href="/assets/js/55.b8588814.js"><link rel="prefetch" href="/assets/js/56.4e2edfd7.js"><link rel="prefetch" href="/assets/js/57.a8d9fa4a.js"><link rel="prefetch" href="/assets/js/58.414e01a8.js"><link rel="prefetch" href="/assets/js/59.7798efc0.js"><link rel="prefetch" href="/assets/js/6.66b905bf.js"><link rel="prefetch" href="/assets/js/60.fcaf78c3.js"><link rel="prefetch" href="/assets/js/61.06d7965c.js"><link rel="prefetch" href="/assets/js/62.9237e4de.js"><link rel="prefetch" href="/assets/js/63.eaad8ff3.js"><link rel="prefetch" href="/assets/js/64.bd9cf3bc.js"><link rel="prefetch" href="/assets/js/65.3cc65b93.js"><link rel="prefetch" href="/assets/js/66.643f1577.js"><link rel="prefetch" href="/assets/js/67.7433abca.js"><link rel="prefetch" href="/assets/js/68.7e1c376a.js"><link rel="prefetch" href="/assets/js/69.eab7d13f.js"><link rel="prefetch" href="/assets/js/7.1f03a9b5.js"><link rel="prefetch" href="/assets/js/70.868cf3f3.js"><link rel="prefetch" href="/assets/js/71.7f892b61.js"><link rel="prefetch" href="/assets/js/72.c0a99a1a.js"><link rel="prefetch" href="/assets/js/73.51ec29b8.js"><link rel="prefetch" href="/assets/js/74.39499d08.js"><link rel="prefetch" href="/assets/js/75.27df10fd.js"><link rel="prefetch" href="/assets/js/76.242d54d7.js"><link rel="prefetch" href="/assets/js/77.28b5088e.js"><link rel="prefetch" href="/assets/js/78.9d0b3415.js"><link rel="prefetch" href="/assets/js/79.64f8809a.js"><link rel="prefetch" href="/assets/js/8.354ea5cd.js"><link rel="prefetch" href="/assets/js/80.bbf10def.js"><link rel="prefetch" href="/assets/js/81.0261a06a.js"><link rel="prefetch" href="/assets/js/82.361f3bd9.js"><link rel="prefetch" href="/assets/js/83.0cf6c8fd.js"><link rel="prefetch" href="/assets/js/84.9de7453c.js"><link rel="prefetch" href="/assets/js/85.b8c91c08.js"><link rel="prefetch" href="/assets/js/86.6f63c4c5.js"><link rel="prefetch" href="/assets/js/87.a156e757.js"><link rel="prefetch" href="/assets/js/88.2fa3e32b.js"><link rel="prefetch" href="/assets/js/89.3b1b7446.js"><link rel="prefetch" href="/assets/js/9.711fb44c.js"><link rel="prefetch" href="/assets/js/90.5ade2fca.js"><link rel="prefetch" href="/assets/js/91.e3c2a9f6.js"><link rel="prefetch" href="/assets/js/92.9a3cc876.js"><link rel="prefetch" href="/assets/js/93.25b823a8.js"><link rel="prefetch" href="/assets/js/94.788e4f7e.js"><link rel="prefetch" href="/assets/js/95.b8c0e52b.js"><link rel="prefetch" href="/assets/js/96.913a506a.js"><link rel="prefetch" href="/assets/js/97.36fa6ccf.js"><link rel="prefetch" href="/assets/js/98.71e0e0eb.js"><link rel="prefetch" href="/assets/js/99.46d66055.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fab77d47.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">偷影子的人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Tool/" class="nav-link router-link-active">
  Tool
</a></div><div class="nav-item"><a href="/Linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/Database/" class="nav-link">
  Database
</a></div><div class="nav-item"><a href="/Web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language" class="mobile-dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/Java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Go/" class="nav-link">
  Go
</a></li></ul></div></div><div class="nav-item"><a href="https://nav.leanway.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Tool/" class="nav-link router-link-active">
  Tool
</a></div><div class="nav-item"><a href="/Linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/Database/" class="nav-link">
  Database
</a></div><div class="nav-item"><a href="/Web/" class="nav-link">
  Web
</a></div><div class="nav-item"><a href="/DevOps/" class="nav-link">
  DevOps
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language" class="dropdown-title"><span class="title">Language</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language" class="mobile-dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/Java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Go/" class="nav-link">
  Go
</a></li></ul></div></div><div class="nav-item"><a href="https://nav.leanway.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>应用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Tool/应用/NGINX.html" class="active sidebar-link">Nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#nginx-安装" class="sidebar-link">NGINX 安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#reference" class="sidebar-link">Reference</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#centos-7" class="sidebar-link">CentOS 7</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#debian-ubuntu-deepin" class="sidebar-link">Debian Ubuntu Deepin</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#windows" class="sidebar-link">Windows</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#modules-安装与使用" class="sidebar-link">Modules 安装与使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#reference-2" class="sidebar-link">Reference</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#模块安装" class="sidebar-link">模块安装</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#模块介绍" class="sidebar-link">模块介绍</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#example" class="sidebar-link">Example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#proxy" class="sidebar-link">Proxy</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#rewrite-return" class="sidebar-link">Rewrite Return</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#stream" class="sidebar-link">Stream</a></li></ul></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#匹配规则" class="sidebar-link">匹配规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#location-匹配规则" class="sidebar-link">location 匹配规则</a></li><li class="sidebar-sub-header"><a href="/Tool/应用/NGINX.html#server-name-参数配置" class="sidebar-link">server_name 参数配置</a></li></ul></li></ul></li><li><a href="/Tool/应用/OneDrive.html" class="sidebar-link">OneDrive</a></li><li><a href="/Tool/应用/Pixiv.html" class="sidebar-link">pixiv 访问</a></li><li><a href="/Tool/应用/Typecho.html" class="sidebar-link">Typecho</a></li><li><a href="/Tool/应用/VuePress.html" class="sidebar-link">VuePress</a></li><li><a href="/Tool/应用/Imgur.html" class="sidebar-link">Imgur</a></li><li><a href="/Tool/应用/HomeBridge.html" class="sidebar-link">HomeBridge</a></li><li><a href="/Tool/应用/CloudFlare_Workers.html" class="sidebar-link">Workers</a></li><li><a href="/Tool/应用/Certbot.html" class="sidebar-link">Certbot</a></li><li><a href="/Tool/应用/Acme.sh.html" class="sidebar-link">Acme.sh</a></li><li><a href="/Tool/应用/Live.html" class="sidebar-link">Live</a></li><li><a href="/Tool/应用/KMS.html" class="sidebar-link">KMS</a></li><li><a href="/Tool/应用/Headless.html" class="sidebar-link">Headless</a></li><li><a href="/Tool/应用/ad.html" class="sidebar-link">ad</a></li><li><a href="/Tool/应用/xshell.html" class="sidebar-link">xshell</a></li><li><a href="/Tool/应用/网盘（文件列表）.html" class="sidebar-link">网盘与文件列表</a></li><li><a href="/Tool/应用/在线协作编辑器.html" class="sidebar-link">在线协作编辑器</a></li><li><a href="/Tool/应用/Windows.html" class="sidebar-link">Windows</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Device</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CICD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Editor</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Download</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h1> <h2 id="nginx-安装"><a href="#nginx-安装" class="header-anchor">#</a> NGINX 安装</h2> <h3 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h3> <ul><li><a href="https://www.nginx.com/resources/wiki/start/topics/examples/initscripts/" target="_blank" rel="noopener noreferrer">initscripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://nginx.org/en/linux_packages.html" target="_blank" rel="noopener noreferrer">linux_packages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://shouce.jb51.net/nginx-doc/" target="_blank" rel="noopener noreferrer">Nginx 中文官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="centos-7"><a href="#centos-7" class="header-anchor">#</a> CentOS 7</h3> <h4 id="包管理器安装"><a href="#包管理器安装" class="header-anchor">#</a> 包管理器安装</h4> <h5 id="rpm"><a href="#rpm" class="header-anchor">#</a> RPM</h5> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">rpm</span> -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
<span class="token function">rpm</span> -ivh http://nginx.org/packages/mainline/centos/7/x86_64/RPMS/nginx-1.17.9-1.el7.ngx.x86_64.rpm
yum info nginx
yum <span class="token function">install</span> nginx
</code></pre></div><h4 id="编译安装"><a href="#编译安装" class="header-anchor">#</a> 编译安装</h4> <h5 id="网络安装"><a href="#网络安装" class="header-anchor">#</a> 网络安装</h5> <ol><li>解决依赖关系和添加用户</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 安装依赖项</span>
yum <span class="token function">install</span> pcre pcre-devel zlib zlib-devel openssl openssl-devel -y
<span class="token comment"># 添加用户</span>
<span class="token function">useradd</span> www -s /sbin/nologin -M
</code></pre></div><ol start="2"><li>下载安装</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span> https://mirrors.163.com/nginx/debian/pool/nginx/n/nginx/nginx_1.12.2.orig.tar.gz
<span class="token function">tar</span> -zxvf nginx_1.12.2.orig.tar.gz
<span class="token builtin class-name">cd</span> nginx-1.12.2
./configure --user<span class="token operator">=</span>www --group<span class="token operator">=</span>www --prefix<span class="token operator">=</span>/usr/local/nginx-1.12.2 --with-http_stub_status_module --with-http_ssl_module
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token function">ln</span> -s /usr/local/nginx-1.12.2/ /usr/local/nginx
</code></pre></div><ol start="3"><li>添加配置文件</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> /etc/nginx
<span class="token function">cp</span> /usr/local/nginx/conf/* /etc/nginx
</code></pre></div><h5 id="本地安装"><a href="#本地安装" class="header-anchor">#</a> 本地安装</h5> <ol><li>安装依赖的库和工具</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>yum <span class="token function">install</span> -y gcc gcc-c++
</code></pre></div><ol start="2"><li>手动下载安装包和必要的组件包</li></ol> <p>nginx必需的三个包：<code>zlib</code> <code>pcre</code> <code>openssl</code></p> <ul><li><a href="https://www.zlib.net/" target="_blank" rel="noopener noreferrer">zlib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 压缩相关库.</li> <li><a href="https://sourceforge.net/projects/pcre/files/pcre/" target="_blank" rel="noopener noreferrer">pcre<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 正则解析库. <a href="https://sourceforge.mirrorservice.org/p/pc/pcre/pcre/" target="_blank" rel="noopener noreferrer">镜像下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/openssl/openssl" target="_blank" rel="noopener noreferrer">openssl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> https协议相关库.</li></ul> <p>nginx安装包下载地址: <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">https://nginx.org/en/download.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span> https://www.zlib.net/zlib-1.2.11.tar.gz
<span class="token function">wget</span> https://nchc.dl.sourceforge.net/project/pcre/pcre/8.41/pcre-8.41.tar.gz
<span class="token function">wget</span> https://codeload.github.com/openssl/openssl/tar.gz/OpenSSL_1_0_2l -O openssl-1.0.2l.tar.gz
<span class="token function">wget</span> https://nginx.org/download/nginx-1.12.2.tar.gz
</code></pre></div><p>安装包的版本分别为：<code>zlib-1.2.11.tar.gz</code> <code>pcre-8.41.tar.gz</code> <code>openssl-1.0.2l.tar.gz</code> <code>nginx-1.12.2.tar.gz</code></p> <p>下载好所有的包后，把所有安装包放到同一目录，解压：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">tar</span> -zxvf zlib-1.2.11.tar.gz
<span class="token function">tar</span> -zxvf pcre-8.41.tar.gz
<span class="token function">tar</span> -zxvf openssl-1.0.2l.tar.gz
<span class="token function">tar</span> -zxvf nginx-1.12.2.tar.gz
<span class="token function">mv</span> openssl-OpenSSL_1_0_2l/ openssl-1.0.2l
</code></pre></div><p>进入到nginx的解压目录，输入以下命令进行配置，这里设置的安装目录为 <code>/usr/local/nginx</code> ，要严格注意每个附加的三个包对应的文件夹名字不要写错了，不然安装不成功。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> nginx-1.12.2
./configure --prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--with-http_ssl_module <span class="token punctuation">\</span>
--with-http_flv_module <span class="token punctuation">\</span>
--with-http_stub_status_module <span class="token punctuation">\</span>
--with-http_gzip_static_module <span class="token punctuation">\</span>
--with-pcre<span class="token operator">=</span><span class="token punctuation">..</span>/pcre-8.41 <span class="token punctuation">\</span>
--with-zlib<span class="token operator">=</span><span class="token punctuation">..</span>/zlib-1.2.11 <span class="token punctuation">\</span>
--with-openssl<span class="token operator">=</span><span class="token punctuation">..</span>/openssl-1.0.2l
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><h3 id="debian-ubuntu-deepin"><a href="#debian-ubuntu-deepin" class="header-anchor">#</a> Debian Ubuntu Deepin</h3> <h4 id="编译安装-2"><a href="#编译安装-2" class="header-anchor">#</a> 编译安装</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">apt</span> <span class="token function">install</span> build-essential libtool -y
<span class="token function">apt</span> <span class="token function">install</span> openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev -y
<span class="token function">wget</span> http://nginx.org/download/nginx-1.11.3.tar.gz
<span class="token function">tar</span> -zxvf nginx-1.11.3.tar.gz
./configure
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>需要修改 nginx-1.11.3/objs/Makefile 中，找到 -Werror 并去掉 在重新make即可。 -Werror 的作用是它要求GCC将所有的警告当成错误进行处理 所以导致错误输出 并不能进行下一步。</p> <h3 id="windows"><a href="#windows" class="header-anchor">#</a> Windows</h3> <p>1、下载 <a href="https://github.com/winsw/winsw/releases/download/v2.1.2/WinSW.NET4.exe" target="_blank" rel="noopener noreferrer">WinSW<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 改文件名为 nginxservice.exe  2、新建 nginxservice.xml   3、nginxservice.exe install</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nginx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>nginx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>nginx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logpath</span><span class="token punctuation">&gt;</span></span>D:\leanway\nginx-1.9.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logpath</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logmode</span><span class="token punctuation">&gt;</span></span>roll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logmode</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depend</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">&gt;</span></span>D:\leanway\nginx-1.9.6\nginx.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stopexecutable</span><span class="token punctuation">&gt;</span></span>D:\leanway\nginx-1.9.6\nginx.exe -s stop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stopexecutable</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="modules-安装与使用"><a href="#modules-安装与使用" class="header-anchor">#</a> Modules 安装与使用</h2> <h3 id="reference-2"><a href="#reference-2" class="header-anchor">#</a> Reference</h3> <ul><li><a href="https://www.cnblogs.com/52fhy/p/10166333.html" target="_blank" rel="noopener noreferrer">Nginx安装echo模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.getpagespeed.com/" target="_blank" rel="noopener noreferrer">nginx-extras<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="模块安装"><a href="#模块安装" class="header-anchor">#</a> 模块安装</h3> <h4 id="编译静态模块"><a href="#编译静态模块" class="header-anchor">#</a> 编译静态模块</h4> <p>以 <code>echo-nginx-module</code> 为例</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span> http://nginx.org/download/nginx-1.16.1.tar.gz
<span class="token function">wget</span> https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz
<span class="token function">tar</span> -zxvf nginx-1.16.1.tar.gz
<span class="token function">tar</span> -zxvf v0.61.tar.gz

./configure <span class="token punctuation">\</span>
--prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--with-http_stub_status_module <span class="token punctuation">\</span>
--with-http_ssl_module <span class="token punctuation">\</span>
--with-http_v2_module <span class="token punctuation">\</span>
--with-http_realip_module <span class="token punctuation">\</span>
--with-http_sub_module <span class="token punctuation">\</span>
--with-http_gzip_static_module <span class="token punctuation">\</span>
--add-module<span class="token operator">=</span><span class="token punctuation">..</span>/echo-nginx-module-0.61

<span class="token function">make</span> -j2
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>注意：**重新编译 <code>Nginx</code> 二进制，<code>Nginx</code> 需要停止重启。**而普通配置更新则 reload 即可：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">kill</span> -QUIT <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /usr/local/nginx/logs/nginx.pid<span class="token variable">`</span></span> <span class="token operator">&amp;&amp;</span> /usr/local/nginx/sbin/nginx
</code></pre></div><p>测试</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span>hello_echo <span class="token punctuation">{</span> 
    <span class="token keyword">default_type</span> <span class="token string">'text/plain'</span><span class="token punctuation">;</span> 
    echo <span class="token string">&quot;hello, echo!&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>echo-nginx-module</code> 模块不仅仅是提供 <code>echo</code> 这么简单的指令，还有其它的指令，详见：<a href="https://github.com/openresty/echo-nginx-module#content-handler-directives" target="_blank" rel="noopener noreferrer">content-handler-directives<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="编译动态模块"><a href="#编译动态模块" class="header-anchor">#</a> 编译动态模块</h4> <p><code>echo-nginx-module</code> 支持以动态模块方式加载，详见：<a href="https://github.com/openresty/echo-nginx-module#installation" target="_blank" rel="noopener noreferrer">installation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。Nginx版本需要 <code>&gt;=1.9.11</code> 。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>./configure <span class="token punctuation">\</span>
--prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--with-http_stub_status_module <span class="token punctuation">\</span>
--with-http_ssl_module <span class="token punctuation">\</span>
--with-http_realip_module <span class="token punctuation">\</span>
--with-http_sub_module <span class="token punctuation">\</span>
--with-http_gzip_static_module  <span class="token punctuation">\</span>
--with-compat <span class="token punctuation">\</span> <span class="token comment"># 动态加载</span>
--with-mail<span class="token operator">=</span>dynamic <span class="token punctuation">\</span> <span class="token comment"># 源码模块</span>
--add-dynamic-module<span class="token operator">=</span><span class="token punctuation">..</span>/echo-nginx-module-0.61 <span class="token comment"># 第三方模块</span>

<span class="token function">make</span> -j2
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>相比静态编译，参数 <code>--add-module</code> 改成了 <code>--add-dynamic-module</code>。</p> <p>编译成功后，会把模块安装在 <code>nginx/modules/</code> 目录。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ <span class="token function">ls</span> /usr/local/nginx/modules/
ngx_http_echo_module.so
</code></pre></div><p>接下来我们需要在 <code>nginx.conf</code> 配置中加入以下两行，实现动态调用模块：</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>load_module <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>modules<span class="token operator">/</span>ngx_http_echo_module<span class="token punctuation">.</span>so<span class="token punctuation">;</span>
</code></pre></div><h3 id="模块介绍"><a href="#模块介绍" class="header-anchor">#</a> 模块介绍</h3> <h4 id="http-ssl-module"><a href="#http-ssl-module" class="header-anchor">#</a> http_ssl_module</h4> <p>HTTPS 基础配置采取的默认加密算法是 SHA-1，这个算法非常脆弱，为此，主流的 HTTPS 配置方案应该避免 SHA-1，可以使用 <a href="https://zh.wikipedia.org/wiki/%E8%BF%AA%E8%8F%B2-%E8%B5%AB%E7%88%BE%E6%9B%BC%E5%AF%86%E9%91%B0%E4%BA%A4%E6%8F%9B" target="_blank" rel="noopener noreferrer">迪菲-赫尔曼密钥交换（D-H，Diffie–Hellman key exchange）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>方案。</p> <ul><li><a href="https://aotu.io/notes/2016/08/16/nginx-https/index.html" target="_blank" rel="noopener noreferrer">Nginx 配置 HTTPS 服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">worker_processes</span> auto<span class="token punctuation">;</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>

    <span class="token comment">#配置共享会话缓存大小，视站点访问情况设定</span>
    <span class="token keyword">ssl_session_cache</span>   shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">10</span>m<span class="token punctuation">;</span>
    <span class="token comment">#配置会话超时时间</span>
    <span class="token keyword">ssl_session_timeout</span> <span class="token number">10</span>m<span class="token punctuation">;</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>              <span class="token number">443</span> <span class="token keyword">ssl</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>         www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        
        <span class="token comment">#设置长连接</span>
        <span class="token keyword">keepalive_timeout</span>   <span class="token number">70</span><span class="token punctuation">;</span>
        
        <span class="token comment">#证书文件</span>
        <span class="token keyword">ssl_certificate</span>     www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">.</span>crt<span class="token punctuation">;</span>
        <span class="token comment">#私钥文件</span>
        <span class="token keyword">ssl_certificate_key</span> www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>com<span class="token punctuation">.</span>key<span class="token punctuation">;</span> 
        
        <span class="token comment">#...</span>
</code></pre></div><h4 id="fancy-index"><a href="#fancy-index" class="header-anchor">#</a> fancy_index</h4> <ul><li><a href="https://www.nginx.com/resources/wiki/modules/fancy_index/" target="_blank" rel="noopener noreferrer">fancy_index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> clone https://github.com/aperezdc/ngx-fancyindex
<span class="token function">git</span> clone https://github.com/cfsego/file-md5
./configure --user<span class="token operator">=</span>www --group<span class="token operator">=</span>www <span class="token punctuation">\</span>
    --prefix<span class="token operator">=</span>/usr/local/nginx-1.12.2 <span class="token punctuation">\</span>
    --with-http_stub_status_module <span class="token punctuation">\</span>
    --with-http_ssl_module <span class="token punctuation">\</span>
    --add-dynamic-module<span class="token operator">=</span><span class="token punctuation">..</span>/ngx-fancyindex <span class="token punctuation">\</span> <span class="token comment"># 添加fancyindex模块</span>
    --add-dynamic-module<span class="token operator">=</span><span class="token punctuation">..</span>/file-md5
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>fancyindex 提供了自定义页头和页脚，分别通过指令 <code>fancyindex_header</code> 和 <code>fancyindex_footer</code> 完成。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span>ftp<span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">alias</span> <span class="token operator">/</span>data<span class="token operator">/</span>software<span class="token operator">/</span>nginx<span class="token operator">/</span><span class="token punctuation">;</span>
    fancyindex on<span class="token punctuation">;</span> <span class="token comment"># 使用fancyindex</span>
    fancyindex_exact_size off<span class="token punctuation">;</span> <span class="token comment"># 不显示精确大小</span>
    fancyindex_footer <span class="token string">&quot;fancy_footer.html&quot;</span><span class="token punctuation">;</span> <span class="token comment"># 指定页脚页面</span>
    fancyindex_ignore <span class="token string">&quot;static&quot;</span><span class="token punctuation">;</span> <span class="token comment"># 隐藏</span>
    <span class="token keyword">add_header</span> Content<span class="token operator">-</span>MD5 <span class="token variable">$file_md</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><a href="http://www.calmkart.com/?p=206" target="_blank" rel="noopener noreferrer">增强nginx的autoindex功能(文件排序，文件MD5值)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/calmkart/nginx_autoindex-/" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>MD5:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
	<span class="token comment"># First attempt to serve request as file, then</span>
	<span class="token comment"># as directory, then fall back to displaying a 404.</span>
	fancyindex on<span class="token punctuation">;</span>
	fancyindex_exact_size off<span class="token punctuation">;</span>
	fancyindex_ignore <span class="token string">&quot;static&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">add_header</span> Content<span class="token operator">-</span>MD5 <span class="token variable">$file_md</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在需要分享的路径创建文件./static/md5.js</p> <ul><li>主题美化</li></ul> <p><a href="https://github.com/TheInsomniac/Nginx-Fancyindex-Theme" target="_blank" rel="noopener noreferrer">Nginx-Fancyindex-Theme<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://gitee.com/8ox86/TheInsomniac-Nginx-Fancyindex-Theme" target="_blank" rel="noopener noreferrer">TheInsomniac-Nginx-Fancyindex-Theme<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://rom.nanodm.net/router/dev/%E4%BD%BF%E7%94%A8nginx%20fancyindex%20%E6%A8%A1%E5%9D%97%E8%AE%A9%E7%BD%91%E7%AB%99%E7%A7%92%E5%8F%98%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BD%E7%AB%99.html" target="_blank" rel="noopener noreferrer">使用nginx fancyindex 模块让网站秒变网盘下载站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="ngx-http-limit-conn-module"><a href="#ngx-http-limit-conn-module" class="header-anchor">#</a> ngx_http_limit_conn_module</h4> <p>限制并发访问，默认安装的内置模块，被用来限制在某一个关键字维度上的最大并发数量，通常情况下，这个维度被设置为访问者的IP。在计算的一个连接当前的并发数量时，不是一连接就会被计数，而是当所有请求头都被读完才计数。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone<span class="token operator">=</span>addr<span class="token punctuation">:</span><span class="token number">10</span>m
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  d2<span class="token punctuation">.</span>dyxmq<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
        <span class="token keyword">limit_conn</span>   addr <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">limit_rate</span>   <span class="token number">1</span>m<span class="token punctuation">;</span> <span class="token comment"># 限制访问速率1M/s</span>
    
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
            <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">access_log</span> logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log main<span class="token punctuation">;</span>
        <span class="token keyword">error_log</span> logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ngx-http-limit-req-module"><a href="#ngx-http-limit-req-module" class="header-anchor">#</a> ngx_http_limit_req_module</h4> <p>限制访问频率</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">http</span> <span class="token punctuation">{</span>
    <span class="token comment"># 以请求IP作为KEY，设置访问频率为1秒1次请求</span>
    <span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone<span class="token operator">=</span>addr<span class="token punctuation">:</span><span class="token number">10</span>m rate<span class="token operator">=</span><span class="token number">1</span>r<span class="token operator">/</span>s<span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span>       <span class="token number">80</span><span class="token punctuation">;</span>
        <span class="token keyword">server_name</span>  d2<span class="token punctuation">.</span>dyxmq<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
        <span class="token comment"># 设置队列为5，最多有5个连接等待，超出的不继续等待</span>
        <span class="token keyword">limit_req</span> zone<span class="token operator">=</span>addr burst<span class="token operator">=</span><span class="token number">5</span> nodelay<span class="token punctuation">;</span>
        <span class="token keyword">limit_rate</span> <span class="token number">1</span>m<span class="token punctuation">;</span>
    
        <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
            <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
            <span class="token keyword">index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token keyword">index</span><span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">access_log</span> logs<span class="token operator">/</span>access<span class="token punctuation">.</span>log main<span class="token punctuation">;</span>
        <span class="token keyword">error_log</span> logs<span class="token operator">/</span>error<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="headers-more-nginx-module"><a href="#headers-more-nginx-module" class="header-anchor">#</a> headers-more-nginx-module</h4> <ul><li><a href="https://www.cnblogs.com/52fhy/p/10166352.html" target="_blank" rel="noopener noreferrer">Nginx里Header修改<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>headers-more-nginx-module 模块用于添加、修改或清除 请求/响应头.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">wget</span> http://nginx.org/download/nginx-1.16.1.tar.gz
<span class="token function">wget</span> https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz
<span class="token function">tar</span> -xzvf nginx-1.16.1.tar.gz
<span class="token function">tar</span> -zxvf v0.33.tar.gz
<span class="token builtin class-name">cd</span> nginx-1.16.1

./configure --prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
     --add-dynamic-module<span class="token operator">=</span><span class="token punctuation">..</span>/headers-more-nginx-module-0.33
     
<span class="token function">make</span> -j2
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>该模块主要有4个指令：</p> <ul><li>more_set_headers 用于添加、修改、清除响应头</li> <li>more_clear_headers 用于清除响应头</li> <li>more_set_input_headers 用于添加、修改、清除请求头</li> <li>more_clear_input_headers 用于清除请求头</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code> <span class="token comment"># set the Server output header</span>
 <span class="token keyword">more_set_headers</span> <span class="token string">'Server: my-server'</span><span class="token punctuation">;</span>

 <span class="token comment"># set and clear output headers</span>
 <span class="token keyword">location</span> <span class="token operator">/</span>bar <span class="token punctuation">{</span>
     <span class="token keyword">more_set_headers</span> <span class="token string">'X-MyHeader: blah'</span> <span class="token string">'X-MyHeader2: foo'</span><span class="token punctuation">;</span>
     <span class="token keyword">more_set_headers</span> <span class="token operator">-</span>t <span class="token string">'text/plain text/css'</span> <span class="token string">'Content-Type: text/foo'</span><span class="token punctuation">;</span>
     <span class="token keyword">more_set_headers</span> <span class="token operator">-</span>s <span class="token string">'400 404 500 503'</span> <span class="token operator">-</span>s <span class="token number">413</span> <span class="token string">'Foo: Bar'</span><span class="token punctuation">;</span>
     more_clear_headers <span class="token string">'Content-Type'</span><span class="token punctuation">;</span>

     <span class="token comment"># your proxy_pass/memcached_pass/or any other config goes here...</span>
 <span class="token punctuation">}</span>

 <span class="token comment"># set output headers</span>
 <span class="token keyword">location</span> <span class="token operator">/</span>type <span class="token punctuation">{</span>
     <span class="token keyword">more_set_headers</span> <span class="token string">'Content-Type: text/plain'</span><span class="token punctuation">;</span>
     <span class="token comment"># ...</span>
 <span class="token punctuation">}</span>

 <span class="token comment"># set input headers</span>
 <span class="token keyword">location</span> <span class="token operator">/</span>foo <span class="token punctuation">{</span>
     <span class="token keyword">set</span> <span class="token variable">$my_host</span> <span class="token string">'my dog'</span><span class="token punctuation">;</span>
     more_set_input_headers <span class="token string">'Host: $my_host'</span><span class="token punctuation">;</span>
     more_set_input_headers <span class="token operator">-</span>t <span class="token string">'text/plain'</span> <span class="token string">'X-Foo: bah'</span><span class="token punctuation">;</span>

     <span class="token comment"># now $host and $http_host have their new values...</span>
     <span class="token comment"># ...</span>
 <span class="token punctuation">}</span>

 <span class="token comment"># replace input header X-Foo *only* if it already exists</span>
 more_set_input_headers <span class="token operator">-</span>r <span class="token string">'X-Foo: howdy'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="nginx-dav-ext-module"><a href="#nginx-dav-ext-module" class="header-anchor">#</a> nginx-dav-ext-module</h4> <ul><li><a href="https://www.binss.me/blog/build-webdav-server-by-nginx/" target="_blank" rel="noopener noreferrer">使用 nginx 搭建 WebDAV 服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://moeclub.org/2017/03/08/13/" target="_blank" rel="noopener noreferrer">WebDAV安装及开机启动脚本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">apt</span> -y <span class="token function">install</span> libxslt-dev
yum -y <span class="token function">install</span> libxslt-devel
<span class="token function">wget</span> http://nginx.org/download/nginx-1.16.1.tar.gz
<span class="token function">wget</span> https://github.com/arut/nginx-dav-ext-module/archive/v3.0.0.tar.gz
<span class="token function">tar</span> -xzvf nginx-1.16.1.tar.gz
<span class="token function">tar</span> -zxvf v3.0.0.tar.gz
<span class="token builtin class-name">cd</span> nginx-1.16.1

./configure --prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--with-http_dav_module <span class="token punctuation">\</span>
--add-module<span class="token operator">=</span><span class="token punctuation">..</span>/nginx-dav-ext-module-3.0.0
     
<span class="token function">make</span> -j2
<span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>客户端使用</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment"># windows webdav</span>
NET USE <span class="token operator">*</span> https:<span class="token operator">/</span><span class="token operator">/</span>test<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token operator">/</span> password <span class="token operator">/</span>USER:huxins
</code></pre></div><p>服务端使用</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2<span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> test<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate</span> conf<span class="token operator">/</span>fullchain<span class="token punctuation">.</span>cer<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> conf<span class="token operator">/</span>_<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>key<span class="token punctuation">;</span>

    <span class="token keyword">client_max_body_size</span> <span class="token number">10240</span>M<span class="token punctuation">;</span>

    <span class="token comment"># rewrite URL to allow create directory</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>

        <span class="token keyword">set</span> <span class="token variable">$dest</span> <span class="token variable">$http_destination</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span>d <span class="token variable">$request_filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">)</span>$ $<span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">;</span>
            <span class="token keyword">set</span> <span class="token variable">$dest</span> <span class="token variable">$dest</span><span class="token operator">/</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">~</span> <span class="token punctuation">(</span>MOVE<span class="token operator">|</span>COPY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            more_set_input_headers <span class="token string">'Destination: $dest'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">~</span> MKCOL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">)</span>$ $<span class="token number">1</span><span class="token operator">/</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">dav_methods</span> PUT DELETE MKCOL COPY MOVE<span class="token punctuation">;</span>
        dav_ext_methods PROPFIND OPTIONS<span class="token punctuation">;</span>
        <span class="token keyword">dav_access</span> <span class="token keyword">user</span><span class="token punctuation">:</span>rw group<span class="token punctuation">:</span>rw all<span class="token punctuation">:</span>r<span class="token punctuation">;</span>
        <span class="token keyword">create_full_put_path</span>  on<span class="token punctuation">;</span>
        <span class="token keyword">root</span> <span class="token operator">/</span>webdav<span class="token punctuation">;</span>

        <span class="token keyword">auth_basic</span> <span class="token string">&quot;Restricted access&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">auth_basic_user_file</span> conf<span class="token operator">/</span>htpasswd<span class="token punctuation">.</span>conf<span class="token punctuation">;</span>

        <span class="token keyword">limit_except</span> GET <span class="token punctuation">{</span>
            <span class="token keyword">allow</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">deny</span>  all<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ngx-http-auth-basic-module"><a href="#ngx-http-auth-basic-module" class="header-anchor">#</a> ngx_http_auth_basic_module</h4> <ul><li><a href="http://tengine.taobao.org/nginx_docs/cn/docs/http/ngx_http_auth_basic_module.html" target="_blank" rel="noopener noreferrer">tengine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">auth_basic</span>           <span class="token string">&quot;closed site&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">auth_basic_user_file</span> conf<span class="token operator">/</span>htpasswd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>htpasswd  <a href="https://tool.oschina.net/htpasswd" target="_blank" rel="noopener noreferrer">在线生成<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code>yum -y <span class="token function">install</span> httpd-tools
htpasswd -c ./passwd username
</code></pre></div><h2 id="example"><a href="#example" class="header-anchor">#</a> Example</h2> <ul><li><a href="https://galaxyyao.github.io/2019/06/17/Nginx-%E6%9B%BF%E6%8D%A2response%20header%E4%B8%AD%E7%9A%84Content-Disposition%E5%80%BC/" target="_blank" rel="noopener noreferrer">Nginx-替换response header中的Content-Disposition值<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000002481473" target="_blank" rel="noopener noreferrer">NGINX的奇淫技巧<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h3> <h4 id="cloudflare"><a href="#cloudflare" class="header-anchor">#</a> CloudFlare</h4> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span><span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> <span class="token number">161.117</span><span class="token number">.251</span><span class="token number">.229</span><span class="token punctuation">;</span>
    <span class="token keyword">access_log</span>  <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>update<span class="token punctuation">.</span>mes<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log<span class="token punctuation">;</span>
    
    <span class="token keyword">default_type</span> <span class="token string">'text/plain'</span><span class="token punctuation">;</span>
    <span class="token keyword">set</span> <span class="token variable">$is_download_file</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token string">&quot;\.(zip|war|html)$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">set</span> <span class="token variable">$is_download_file</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_uri</span> <span class="token operator">!</span><span class="token operator">~</span> <span class="token string">&quot;(/)$&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">set</span> <span class="token variable">$is_download_file</span> <span class="token number">0</span><span class="token variable">$is_download_file</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$is_download_file</span> <span class="token operator">=</span> <span class="token number">00</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">rewrite</span> <span class="token operator">^</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">161.117</span><span class="token number">.251</span><span class="token number">.229</span><span class="token variable">$request_uri</span><span class="token operator">/</span> last<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span> 
        <span class="token keyword">proxy_pass</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">1.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> Host yun<span class="token operator">-</span>qq<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">;</span>

        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> REMOTE<span class="token operator">-</span>HOST <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>

        proxy_ssl_name yun<span class="token operator">-</span>qq<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        proxy_ssl_server_name on<span class="token punctuation">;</span>

        <span class="token keyword">sub_filter_once</span> off<span class="token punctuation">;</span>
        <span class="token keyword">sub_filter_types</span> text<span class="token operator">/</span>html<span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> yun<span class="token operator">-</span>qq<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com update<span class="token punctuation">.</span>mes<span class="token punctuation">.</span>leanway<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="github"><a href="#github" class="header-anchor">#</a> GitHub</h4> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> github <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.30</span><span class="token number">.253</span><span class="token number">.112</span><span class="token punctuation">:</span><span class="token number">443</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.30</span><span class="token number">.253</span><span class="token number">.113</span><span class="token punctuation">:</span><span class="token number">443</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span> <span class="token number">443</span> <span class="token keyword">ssl</span> http2 reuseport<span class="token punctuation">;</span>
    <span class="token keyword">listen</span> <span class="token number">80</span> reuseport<span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> test<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">;</span> <span class="token comment">#绑定的域名</span>
    
    <span class="token keyword">root</span> <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>nginx<span class="token operator">/</span>html<span class="token punctuation">;</span>
    
    <span class="token keyword">resolver</span> <span class="token number">8.8</span><span class="token number">.8</span><span class="token number">.8</span> <span class="token number">8.8</span><span class="token number">.4</span><span class="token number">.4</span> valid<span class="token operator">=</span><span class="token number">600</span>s<span class="token punctuation">;</span>
    <span class="token keyword">resolver_timeout</span> <span class="token number">10</span>s<span class="token punctuation">;</span>

    <span class="token keyword">ssl_certificate</span> conf<span class="token punctuation">.</span>d<span class="token operator">/</span>fullchain<span class="token punctuation">.</span>cer<span class="token punctuation">;</span>
    <span class="token keyword">ssl_certificate_key</span> conf<span class="token punctuation">.</span>d<span class="token operator">/</span>_<span class="token punctuation">.</span>lhcdn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>key<span class="token punctuation">;</span>

    <span class="token keyword">ssl_session_timeout</span>      <span class="token number">1</span>d<span class="token punctuation">;</span>
    <span class="token keyword">ssl_session_cache</span>        shared<span class="token punctuation">:</span><span class="token keyword">SSL</span><span class="token punctuation">:</span><span class="token number">50</span>m<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token string">&quot;qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Feedfetcher-Google|Yahoo! Slurp|Yahoo! Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot|ia_archiver|Tomato Bot&quot;</span><span class="token punctuation">)</span> <span class="token comment">#防止搜索引擎收录</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">(</span>conf<span class="token operator">|</span>sql<span class="token operator">|</span>bak<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">!</span><span class="token operator">~</span> <span class="token operator">^</span><span class="token punctuation">(</span>GET<span class="token operator">|</span>HEAD<span class="token operator">|</span>POST<span class="token punctuation">)</span>$ <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>    <span class="token number">444</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">^</span><span class="token operator">/</span><span class="token punctuation">(</span>repo\<span class="token punctuation">.</span>mongodb\<span class="token punctuation">.</span>com<span class="token operator">|</span>repo\<span class="token punctuation">.</span>mysql\<span class="token punctuation">.</span>com<span class="token operator">|</span>www\<span class="token punctuation">.</span>debian\<span class="token punctuation">.</span>org<span class="token operator">|</span>deb\<span class="token punctuation">.</span>debian\<span class="token punctuation">.</span>org<span class="token operator">|</span>security\<span class="token punctuation">.</span>debian\<span class="token punctuation">.</span>org<span class="token operator">|</span>cdn<span class="token operator">-</span>fastly\<span class="token punctuation">.</span>deb<span class="token punctuation">.</span>debian\<span class="token punctuation">.</span>org<span class="token operator">|</span>nginx\<span class="token punctuation">.</span>org<span class="token operator">|</span>github\<span class="token punctuation">.</span>com<span class="token operator">|</span>codeload\<span class="token punctuation">.</span>github\<span class="token punctuation">.</span>com<span class="token operator">|</span>yum\<span class="token punctuation">.</span>dockerproject\<span class="token punctuation">.</span>org<span class="token punctuation">)</span><span class="token punctuation">(</span>\<span class="token operator">/</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        <span class="token comment">#需要代理的域名，正则，避免有人用来代理某些被墙的网站，导致反向代理被gfw误杀。</span>
        <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Real<span class="token operator">-</span>IP  <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token comment">#将用户ip放到请求协议头内，一般用来告诉后端服务器，是谁访问的网站。</span>
        <span class="token keyword">proxy_set_header</span> Accept<span class="token operator">-</span>Encoding <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">#告诉被代理网站，不要压缩内容，否则sub_filter会失效。</span>
        <span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_connect_timeout</span>    <span class="token number">10</span>s<span class="token punctuation">;</span>
        <span class="token keyword">proxy_read_timeout</span>       <span class="token number">10</span>s<span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> Host $<span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_redirect</span> <span class="token operator">~</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword">http</span><span class="token punctuation">:</span>\<span class="token operator">/</span>\<span class="token operator">/</span><span class="token operator">|</span><span class="token keyword">https</span><span class="token punctuation">:</span>\<span class="token operator">/</span>\<span class="token operator">/</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ $<span class="token number">1</span><span class="token variable">$server_name</span><span class="token operator">/</span>$<span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">#将原301跳转，重新跳转回本域名。</span>
        
        <span class="token keyword">sub_filter</span> <span class="token string">'src=&quot;/'</span> <span class="token string">'src=&quot;/$1/'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'src=&quot;http://$1'</span> <span class="token string">'src=&quot;http://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'src=&quot;https://$1'</span> <span class="token string">'src=&quot;https://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'src=&quot;//$1'</span> <span class="token string">'src=&quot;//$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token comment">#替换网页内链接地址。</span>
        
        <span class="token keyword">sub_filter</span> <span class="token string">'href=&quot;/'</span> <span class="token string">'href=&quot;/$1/'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'href=&quot;http://$1'</span> <span class="token string">'href=&quot;http://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'href=&quot;https://$1'</span> <span class="token string">'href=&quot;https://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'href=&quot;//$1'</span> <span class="token string">'href=&quot;//$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token comment">#同上</span>

        <span class="token keyword">sub_filter</span> <span class="token string">'action=&quot;/'</span> <span class="token string">'action=&quot;/$1/'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'action=&quot;http://$1'</span> <span class="token string">'action=&quot;http://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'action=&quot;https://$1'</span> <span class="token string">'action=&quot;https://$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token keyword">sub_filter</span> <span class="token string">'action=&quot;//$1'</span> <span class="token string">'action=&quot;//$server_name/$1'</span><span class="token punctuation">;</span>
        <span class="token comment">#同上</span>

        <span class="token keyword">sub_filter_once</span> off<span class="token punctuation">;</span>
        <span class="token comment">#替换多次</span>

        <span class="token keyword">proxy_hide_header</span> Strict<span class="token operator">-</span>Transport<span class="token operator">-</span>Security<span class="token punctuation">;</span>
        <span class="token comment">#隐藏被代理网站返回回来的协议头“Strict-Transport-Security”，避免启动hsts，具体搜索引擎hsts</span>
        
        <span class="token keyword">set</span> <span class="token variable">$query_mark</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$query_string</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">set</span> <span class="token variable">$query_mark</span> <span class="token string">&quot;?${query_string}&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">#因为nginx并不匹配url后面的?参数，而是使用“$query_string”储存。</span>
        <span class="token keyword">proxy_pass</span> <span class="token variable">$scheme</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>$<span class="token number">1</span>$<span class="token number">2</span>$<span class="token punctuation">{</span>query_mark<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">#$scheme是当前访问的协议,http、https</span>

        <span class="token comment">#proxy_pass https://github;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="rewrite-return"><a href="#rewrite-return" class="header-anchor">#</a> Rewrite Return</h3> <h4 id="snippet"><a href="#snippet" class="header-anchor">#</a> Snippet</h4> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span>$<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">rewrite</span> <span class="token operator">^</span> <span class="token keyword">https</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token operator">?</span> permanent<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token number">301</span> <span class="token variable">$scheme</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>

<span class="token comment"># 防盗链</span>
<span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> \<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>swf<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  <span class="token keyword">valid_referers</span> none blocked start<span class="token punctuation">.</span>igrow<span class="token punctuation">.</span>cn sta<span class="token punctuation">.</span>igrow<span class="token punctuation">.</span>cn<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">#防盗链</span>
    <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token variable">$host</span><span class="token operator">/</span>logo<span class="token punctuation">.</span>png<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ip"><a href="#ip" class="header-anchor">#</a> IP</h4> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
    <span class="token keyword">default_type</span> text<span class="token operator">/</span>plain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">location</span> <span class="token operator">/</span>json <span class="token punctuation">{</span>
    <span class="token keyword">default_type</span> application<span class="token operator">/</span>json<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;{\&quot;ip\&quot;:\&quot;$remote_addr\&quot;}&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="stream"><a href="#stream" class="header-anchor">#</a> Stream</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code>stream <span class="token punctuation">{</span>
    <span class="token keyword">upstream</span> mstsc <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token punctuation">:</span><span class="token number">3389</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">33389</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span> mstsc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

stream <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">8080</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_connect_timeout</span> <span class="token number">10</span>s<span class="token punctuation">;</span>
        <span class="token keyword">proxy_timeout</span> <span class="token number">10</span>s<span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">3389</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="匹配规则"><a href="#匹配规则" class="header-anchor">#</a> 匹配规则</h2> <h3 id="location-匹配规则"><a href="#location-匹配规则" class="header-anchor">#</a> location 匹配规则</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">location</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">|</span><span class="token operator">~</span><span class="token operator">*</span><span class="token operator">|</span><span class="token operator">^</span><span class="token operator">~</span><span class="token punctuation">]</span> <span class="token operator">/</span>uri<span class="token operator">/</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>符号</th> <th>含义</th></tr></thead> <tbody><tr><td>=</td> <td>表示精确匹配</td></tr> <tr><td>^~</td> <td>表示 URI 以某个常规字符串开头。Nginx 不对 URL 做编码，因此请求为 /static/20%/aa，可以被 ^~ /static/ /aa 匹配到</td></tr> <tr><td>~</td> <td>表示区分大小写的正则匹配</td></tr> <tr><td>~*</td> <td>表示不区分大小写的正则匹配</td></tr> <tr><td>/</td> <td>通用匹配，任何请求都会匹配</td></tr></tbody></table> <p>多个 location 配置的情况下匹配顺序为：</p> <ul><li>首先匹配 =</li> <li>其次匹配 ^~</li> <li>其次是按文件中顺序的正则匹配</li> <li>最后是交给 /</li> <li>当有匹配成功时候，停止匹配，按当前匹配规则处理请求</li></ul> <h3 id="server-name-参数配置"><a href="#server-name-参数配置" class="header-anchor">#</a> server_name 参数配置</h3> <ol><li>确切的server_name匹配</li> <li>以*通配符开始的最长字符串</li> <li>以*通配符结束的最长字符串</li></ol> <p>注意: 通配符名字只可以在名字的起始处或结尾处包含一个星号，并且星号与其他字符之间用点分隔。所以，<code>www.*.example.org</code> 和 <code>w*.example.org</code> 都是非法的。</p> <p>有一种形 如“.example.org”的特殊通配符，它可以既匹配确切的名字“example.org”，又可以匹配一般的通配符名字“*.example.org”。</p> <ol start="4"><li>匹配正则表达式</li></ol> <p>为了使用正则表达式，虚拟主机名必须以 <code>波浪线“~”</code> 起始否则该名字会被认为是个确切的名字</p> <p><code>~^([^.]+)\.example\.com&gt; *.example.com</code></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2021, 12:10:31 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Tool/应用/OneDrive.html">
        OneDrive
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1e781c0e.js" defer></script><script src="/assets/js/2.8b1cd733.js" defer></script><script src="/assets/js/118.bf00b42e.js" defer></script>
  </body>
</html>
